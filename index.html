<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Easy Go | Item</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
        .main-content { flex: 1; }
        .quantity-btn { width: 45px; height: 45px; border-radius: 50%; }
        .pack-option { transition: all 0.3s; }
        .pack-option.selected { border-color: #10b981; background-color: #f0fdf4; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-weight: bold;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        .delete-btn:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="antialiased bg-gray-50 flex flex-col min-h-screen">

    <div class="main-content">
        <!-- Header with Banner -->
        <header class="relative mb-8">
            <div class="h-40 overflow-hidden">
                <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/Banner.png" 
                     class="w-full h-full object-cover" alt="Easy Go Banner">
            </div>
            <div class="absolute -bottom-6 left-0 right-0 flex justify-center">
                <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png" 
                     class="h-20 w-20 rounded-full border-4 border-white shadow-xl bg-white p-1">
            </div>
        </header>

        <div class="max-w-4xl mx-auto px-4 pt-10 pb-8">
            <!-- Back Button and Cart Info -->
            <div class="flex justify-between items-center mb-8">
                <a href="https://clean-scripts.github.io/Easygo-Menu/" 
                   class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Back to Menu
                </a>
                <div id="cart-summary" class="hidden">
                    <a href="https://clean-scripts.github.io/Easygo-Cart/" 
                       class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-2xl hover:bg-green-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        <span id="cart-count" class="font-bold">0</span> items
                    </a>
                </div>
            </div>

            <!-- Item Details -->
            <div id="item-details" class="bg-white rounded-3xl shadow-lg p-8 mb-8">
                <!-- Item will be dynamically loaded here -->
                <div class="flex justify-center">
                    <div class="loader"></div>
                </div>
            </div>

            <!-- Pack Size Selector (Hidden initially) -->
            <div id="pack-selector" class="bg-white rounded-3xl shadow-lg p-8 mb-8 hidden">
                <h3 class="text-2xl font-bold mb-6">Select Pack Size</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="pack-options-container">
                    <!-- Pack options will be dynamically loaded here -->
                </div>
            </div>

            <!-- Quantity Selector (Hidden initially) -->
            <div id="quantity-selector" class="bg-white rounded-3xl shadow-lg p-8 mb-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold">Quantity</h3>
                    <button id="delete-item" class="delete-btn hidden">
                        ‚ùå Delete Item
                    </button>
                </div>
                
                <div class="flex flex-col items-center gap-6">
                    <div class="flex items-center justify-center gap-6">
                        <button id="decrease-qty" class="quantity-btn bg-gray-100 hover:bg-gray-200 text-2xl font-bold disabled:opacity-50 disabled:cursor-not-allowed" disabled>-</button>
                        <span id="quantity-display" class="text-5xl font-black w-20 text-center">1</span>
                        <button id="increase-qty" class="quantity-btn bg-gray-100 hover:bg-gray-200 text-2xl font-bold">+</button>
                    </div>
                    <p id="quantity-info" class="text-center text-gray-600 text-sm"></p>
                    
                    <!-- Quick Quantity Buttons -->
                    <div class="flex gap-2 mt-4">
                        <button class="quick-qty-btn px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 text-sm font-medium" data-qty="1">1</button>
                        <button class="quick-qty-btn px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 text-sm font-medium" data-qty="2">2</button>
                        <button class="quick-qty-btn px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 text-sm font-medium" data-qty="4">4</button>
                        <button class="quick-qty-btn px-4 py-2 bg-gray-100 rounded-xl hover:bg-gray-200 text-sm font-medium" data-qty="8">8</button>
                    </div>
                </div>
            </div>

            <!-- Total & Add to Cart -->
            <div id="cart-section" class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-3xl shadow-lg p-8 hidden">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <p class="text-white/80 text-sm">Total Price</p>
                        <p id="total-price" class="text-5xl font-black text-white">‚Çπ0</p>
                    </div>
                    <div class="text-right">
                        <p id="pack-size-display" class="text-white font-bold">Select pack size</p>
                        <p id="quantity-summary" class="text-white/80">Quantity: 1</p>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button id="update-cart" 
                            class="flex-1 py-5 bg-white text-green-600 text-xl font-bold rounded-2xl hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed hidden"
                            disabled>
                        üîÑ Update Cart
                    </button>
                    <button id="add-to-cart" 
                            class="flex-1 py-5 bg-white text-green-600 text-xl font-bold rounded-2xl hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                        üõí Add to Cart
                    </button>
                </div>
                <p class="text-white/80 text-sm text-center mt-4">
                    Changes are saved automatically. Visit cart to review all items.
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-8 bg-gray-50 mt-auto border-t border-gray-200">
        <div class="max-w-4xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-center md:text-left">
                    <div class="flex items-center justify-center md:justify-start gap-3">
                        <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png" 
                             class="h-10 w-10 rounded-full border-2 border-white shadow">
                        <div>
                            <h3 class="text-lg font-black uppercase tracking-tight">Easy Go</h3>
                            <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">Freshness & Speed Delivered</p>
                        </div>
                    </div>
                    <p class="text-[10px] font-medium text-gray-500 mt-4 max-w-md">
                        MSME | FSSAI | GST Registered ‚Ä¢ Free Delivery above ‚Çπ199 ‚Ä¢ Serving daily from 5:45 PM to 10:30 PM
                    </p>
                </div>
                
                <div class="flex flex-col items-center gap-3">
                    <div class="flex gap-4">
                        <a href="https://wa.me/917651837322" target="_blank" 
                           class="bg-green-500 text-white p-3 rounded-2xl shadow-lg hover:bg-green-600 transition-all">
                            <span class="font-black text-xs uppercase">WhatsApp</span>
                        </a>
                        <a href="https://clean-scripts.github.io/Easygo-Cart/" 
                           class="bg-indigo-500 text-white p-3 rounded-2xl shadow-lg hover:bg-indigo-600 transition-all">
                            <span class="font-black text-xs uppercase">View Cart</span>
                        </a>
                    </div>
                    <p class="text-[8px] font-bold text-gray-400 uppercase tracking-widest text-center">
                        ¬© 2024 Easy Go ‚Ä¢ All Rights Reserved
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Get item from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get('item');
        
        // Item database with corrected pricing
        const items = {
            // Veg Momos - Steamed
            'veg-momos-steamed': {
                id: 'veg-momos-steamed',
                name: 'Veg Momos (Steamed)',
                description: 'Delicious steamed vegetable momos with our special garlic sauce. Perfect healthy snack!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/veg.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'steamed',
                piecePrice: 9,  // ‚Çπ9 per piece
                packPrices: {
                    'standard': 59,     // 8 pcs = ‚Çπ59
                    'family': 99,       // 16 pcs = ‚Çπ99
                    'xl': 199           // 32 pcs = ‚Çπ199
                }
            },
            // Veg Momos - Fried
            'veg-momos-fried': {
                id: 'veg-momos-fried',
                name: 'Veg Momos (Fried)',
                description: 'Crispy fried vegetable momos with spicy red chutney. Extra crunchy goodness!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/veg.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'fried',
                piecePrice: 10,  // ‚Çπ10 per piece
                packPrices: {
                    'standard': 79,     // 8 pcs = ‚Çπ79
                    'family': 149,      // 16 pcs = ‚Çπ149
                    'xl': 299           // 32 pcs = ‚Çπ299
                }
            },
            // Cheese Corn Momos - Steamed
            'cheese-corn-steamed': {
                id: 'cheese-corn-steamed',
                name: 'Cheese Corn Momos (Steamed)',
                description: 'Steamed momos filled with melted cheese and sweet corn. Creamy delight!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/cheese-corn.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'steamed',
                piecePrice: 12,  // ‚Çπ12 per piece
                packPrices: {
                    'standard': 89,     // 8 pcs = ‚Çπ89
                    'family': 169,      // 16 pcs = ‚Çπ169
                    'xl': 349           // 32 pcs = ‚Çπ349
                }
            },
            // Cheese Corn Momos - Fried
            'cheese-corn-fried': {
                id: 'cheese-corn-fried',
                name: 'Cheese Corn Momos (Fried)',
                description: 'Fried cheesy corn momos with creamy mayo dip. Ultimate cheesy treat!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/cheese-corn.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'fried',
                piecePrice: 15,  // ‚Çπ15 per piece
                packPrices: {
                    'standard': 99,     // 8 pcs = ‚Çπ99
                    'family': 179,      // 16 pcs = ‚Çπ179
                    'xl': 369           // 32 pcs = ‚Çπ369
                }
            },
            // Paneer Momos - Steamed
            'paneer-steamed': {
                id: 'paneer-steamed',
                name: 'Paneer Momos (Steamed)',
                description: 'Steamed momos with spicy paneer filling. Rich and protein-packed!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/paneer.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'steamed',
                piecePrice: 12,  // ‚Çπ12 per piece
                packPrices: {
                    'standard': 79,     // 8 pcs = ‚Çπ79
                    'family': 149,      // 16 pcs = ‚Çπ149
                    'xl': 299           // 32 pcs = ‚Çπ299
                }
            },
            // Paneer Momos - Fried
            'paneer-fried': {
                id: 'paneer-fried',
                name: 'Paneer Momos (Fried)',
                description: 'Crispy fried paneer momos with mint coriander chutney.',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/paneer.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'fried',
                piecePrice: 15,  // ‚Çπ15 per piece
                packPrices: {
                    'standard': 89,     // 8 pcs = ‚Çπ89
                    'family': 169,      // 16 pcs = ‚Çπ169
                    'xl': 329           // 32 pcs = ‚Çπ329
                }
            },
            // Mini Samosas
            'mini-samosas': {
                id: 'mini-samosas',
                name: 'Mini Samosas',
                description: 'Crispy mini samosas with spicy potato-peas filling. Perfect tea-time snack!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/samosas.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: true,
                type: 'standard',
                piecePrice: 10,  // ‚Çπ10 per piece
                packPrices: {
                    'standard': 69,     // 8 pcs = ‚Çπ69
                    'family': 149,      // 16 pcs = ‚Çπ149
                    'xl': 259           // 32 pcs = ‚Çπ259
                }
            },
            // French Fries
            'french-fries': {
                id: 'french-fries',
                name: 'French Fries',
                description: 'Golden crispy french fries with special seasoning. Addictively delicious!',
                image: 'https://raw.githubusercontent.com/Clean-Scripts/Easygo-Menu/refs/heads/main/fries.png',
                category: 'Hot & Fresh Snacks',
                hasPieces: false,
                packs: {
                    'standard': { weight: '200g', price: 69 },
                    'family': { weight: '500g', price: 169 },
                    'xl': { weight: '1Kg', price: 299 }
                }
            }
        };

        // Current item and state
        let currentItem = null;
        let quantity = 1;
        let selectedPack = null;
        let isPiecePack = false;
        let existingCartItem = null;
        let isUpdatingExisting = false;

        // Cart management functions
        function loadCart() {
            try {
                const cartData = localStorage.getItem('easygo-cart');
                return cartData ? JSON.parse(cartData) : [];
            } catch (error) {
                console.error('Error loading cart:', error);
                return [];
            }
        }

        function saveCart(cart) {
            try {
                localStorage.setItem('easygo-cart', JSON.stringify(cart));
                updateCartSummary();
            } catch (error) {
                console.error('Error saving cart:', error);
            }
        }

        function updateCartSummary() {
            const cart = loadCart();
            const cartSummary = document.getElementById('cart-summary');
            const cartCount = document.getElementById('cart-count');
            
            if (cart.length > 0) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                cartSummary.classList.remove('hidden');
            } else {
                cartSummary.classList.add('hidden');
            }
        }

        function checkIfItemInCart() {
            if (!currentItem || !selectedPack) return null;
            
            const cart = loadCart();
            const itemKey = `${currentItem.id}-${selectedPack}`;
            
            return cart.find(item => item.id === itemKey) || null;
        }

        // Quantity button handlers
        function setupQuantityButtons() {
            // Increase quantity
            document.getElementById('increase-qty').onclick = () => {
                if (!selectedPack) return;
                
                let maxQuantity = 99;
                
                if (quantity < maxQuantity) {
                    quantity++;
                    document.getElementById('quantity-display').textContent = quantity;
                    
                    if (quantity > 1) {
                        document.getElementById('decrease-qty').disabled = false;
                    }
                    
                    updateTotal();
                }
            };

            // Decrease quantity
            document.getElementById('decrease-qty').onclick = () => {
                if (quantity > 1) {
                    quantity--;
                    document.getElementById('quantity-display').textContent = quantity;
                    
                    if (quantity === 1) {
                        document.getElementById('decrease-qty').disabled = true;
                    }
                    
                    updateTotal();
                }
            };

            // Quick quantity buttons
            document.querySelectorAll('.quick-qty-btn').forEach(btn => {
                btn.onclick = () => {
                    if (!selectedPack) return;
                    
                    const newQty = parseInt(btn.dataset.qty);
                    quantity = newQty;
                    document.getElementById('quantity-display').textContent = quantity;
                    
                    if (quantity > 1) {
                        document.getElementById('decrease-qty').disabled = false;
                    } else {
                        document.getElementById('decrease-qty').disabled = true;
                    }
                    
                    updateTotal();
                };
            });
        }

        // Initialize page
        function initPage() {
            if (!itemId || !items[itemId]) {
                window.location.href = 'https://clean-scripts.github.io/Easygo-Menu/';
                return;
            }

            currentItem = items[itemId];
            loadItemDetails();
            setupQuantityButtons();
            updateCartSummary();
        }

        // Load item details
        function loadItemDetails() {
            const container = document.getElementById('item-details');
            
            container.innerHTML = `
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/2 flex items-center justify-center">
                        <img src="${currentItem.image}" 
                             alt="${currentItem.name}" 
                             class="w-full max-w-md h-auto object-contain rounded-3xl shadow-lg">
                    </div>
                    <div class="md:w-1/2">
                        <p class="text-sm font-bold text-green-600 uppercase tracking-widest">${currentItem.category}</p>
                        <h1 class="text-4xl font-black uppercase mt-2">${currentItem.name}</h1>
                        <p class="text-gray-600 text-lg mt-4 leading-relaxed">${currentItem.description}</p>
                        
                        ${currentItem.hasPieces ? `
                        <div class="mt-8 p-6 bg-gray-50 rounded-2xl">
                            <p class="text-sm text-gray-500 mb-2">Price Per Piece</p>
                            <p class="text-3xl font-bold text-green-600">‚Çπ${currentItem.piecePrice}/piece</p>
                            <p class="text-sm text-gray-500 mt-2">8 Pieces = ‚Çπ${currentItem.packPrices.standard}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            loadPackOptions();
            
            // Show sections
            document.getElementById('pack-selector').classList.remove('hidden');
            document.getElementById('quantity-selector').classList.remove('hidden');
            document.getElementById('cart-section').classList.remove('hidden');
        }

        // Load pack options
        function loadPackOptions() {
            const container = document.getElementById('pack-options-container');
            
            if (currentItem.hasPieces) {
                container.innerHTML = `
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="piece" data-price="${currentItem.piecePrice}" data-pieces="1">
                        <p class="font-bold text-lg">Per Piece</p>
                        <p class="text-gray-600 text-sm">Individual</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.piecePrice}/piece</p>
                    </div>
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="standard" data-price="${currentItem.packPrices.standard}" data-pieces="8">
                        <p class="font-bold text-lg">Standard</p>
                        <p class="text-gray-600 text-sm">8 Pieces</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packPrices.standard}</p>
                    </div>
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="family" data-price="${currentItem.packPrices.family}" data-pieces="16">
                        <p class="font-bold text-lg">Family Pack</p>
                        <p class="text-gray-600 text-sm">16 Pieces</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packPrices.family}</p>
                    </div>
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="xl" data-price="${currentItem.packPrices.xl}" data-pieces="32">
                        <p class="font-bold text-lg">Extra Large</p>
                        <p class="text-gray-600 text-sm">32 Pieces</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packPrices.xl}</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="standard" data-price="${currentItem.packs.standard.price}" data-weight="${currentItem.packs.standard.weight}">
                        <p class="font-bold text-lg">Standard</p>
                        <p class="text-gray-600 text-sm">${currentItem.packs.standard.weight}</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packs.standard.price}</p>
                    </div>
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="family" data-price="${currentItem.packs.family.price}" data-weight="${currentItem.packs.family.weight}">
                        <p class="font-bold text-lg">Family Pack</p>
                        <p class="text-gray-600 text-sm">${currentItem.packs.family.weight}</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packs.family.price}</p>
                    </div>
                    <div class="pack-option border-2 border-gray-200 rounded-2xl p-4 text-center cursor-pointer hover:border-green-300"
                         data-pack="xl" data-price="${currentItem.packs.xl.price}" data-weight="${currentItem.packs.xl.weight}">
                        <p class="font-bold text-lg">Extra Large</p>
                        <p class="text-gray-600 text-sm">${currentItem.packs.xl.weight}</p>
                        <p class="text-green-600 font-bold mt-2">‚Çπ${currentItem.packs.xl.price}</p>
                    </div>
                    <div class="border-2 border-gray-100 rounded-2xl p-4 text-center opacity-50 cursor-not-allowed">
                        <p class="font-bold text-lg text-gray-400">Per Piece</p>
                        <p class="text-gray-400 text-sm">Not Available</p>
                        <p class="text-gray-400 font-bold mt-2">-</p>
                    </div>
                `;
            }
            
            // Add click handlers to pack options
            document.querySelectorAll('.pack-option').forEach(option => {
                option.onclick = function() {
                    // Remove selected class from all
                    document.querySelectorAll('.pack-option').forEach(opt => {
                        opt.classList.remove('selected', 'border-green-500', 'bg-green-50');
                        opt.classList.add('border-gray-200');
                    });
                    
                    // Add to clicked
                    this.classList.add('selected', 'border-green-500', 'bg-green-50');
                    this.classList.remove('border-gray-200');
                    
                    // Update selection
                    selectedPack = this.dataset.pack;
                    isPiecePack = (selectedPack === 'piece');
                    
                    // Check if this item already exists in cart
                    existingCartItem = checkIfItemInCart();
                    isUpdatingExisting = existingCartItem !== null;
                    
                    // Set quantity based on existing cart item or default
                    quantity = existingCartItem ? existingCartItem.quantity : 1;
                    document.getElementById('quantity-display').textContent = quantity;
                    
                    // Show/hide appropriate buttons
                    const deleteBtn = document.getElementById('delete-item');
                    const updateBtn = document.getElementById('update-cart');
                    const addBtn = document.getElementById('add-to-cart');
                    
                    if (isUpdatingExisting) {
                        deleteBtn.classList.remove('hidden');
                        updateBtn.classList.remove('hidden');
                        addBtn.classList.add('hidden');
                    } else {
                        deleteBtn.classList.add('hidden');
                        updateBtn.classList.add('hidden');
                        addBtn.classList.remove('hidden');
                    }
                    
                    // Enable/disable quantity buttons
                    const decreaseBtn = document.getElementById('decrease-qty');
                    
                    decreaseBtn.disabled = quantity <= 1;
                    document.getElementById('increase-qty').disabled = false;
                    
                    // Enable cart buttons
                    updateBtn.disabled = false;
                    addBtn.disabled = false;
                    
                    // Setup cart button handlers
                    setupCartButtons();
                    
                    // Update display and total
                    updatePackDisplay();
                    updateTotal();
                };
            });
            
            // Check if any pack should be pre-selected based on existing cart item
            const cart = loadCart();
            for (const item of cart) {
                if (item.itemId === currentItem.id) {
                    const packToSelect = document.querySelector(`.pack-option[data-pack="${item.pack}"]`);
                    if (packToSelect) {
                        setTimeout(() => {
                            packToSelect.click();
                        }, 100);
                    }
                    break;
                }
            }
        }

        // Setup cart button handlers
        function setupCartButtons() {
            // Delete button
            document.getElementById('delete-item').onclick = () => {
                if (!isUpdatingExisting || !existingCartItem) return;
                
                if (confirm(`Are you sure you want to remove "${currentItem.name}" from your cart?`)) {
                    const cart = loadCart();
                    const itemKey = `${currentItem.id}-${selectedPack}`;
                    
                    // Remove the item
                    const updatedCart = cart.filter(item => item.id !== itemKey);
                    saveCart(updatedCart);
                    
                    // Reset state
                    existingCartItem = null;
                    isUpdatingExisting = false;
                    quantity = 1;
                    document.getElementById('quantity-display').textContent = quantity;
                    
                    // Update UI
                    document.getElementById('delete-item').classList.add('hidden');
                    document.getElementById('update-cart').classList.add('hidden');
                    document.getElementById('add-to-cart').classList.remove('hidden');
                    
                    // Update cart summary
                    updateCartSummary();
                    
                    // Show success message
                    alert(`‚úÖ Item removed from cart!`);
                    
                    updateTotal();
                }
            };

            // Update cart button
            document.getElementById('update-cart').onclick = () => {
                saveItemToCart();
            };

            // Add to cart button
            document.getElementById('add-to-cart').onclick = () => {
                saveItemToCart();
            };
        }

        // Update pack display info
        function updatePackDisplay() {
            const packDisplay = document.getElementById('pack-size-display');
            const quantityInfo = document.getElementById('quantity-info');
            
            if (currentItem.hasPieces) {
                const packNames = {
                    'piece': 'Per Piece',
                    'standard': 'Standard Pack',
                    'family': 'Family Pack',
                    'xl': 'Extra Large Pack'
                };
                
                const packPieces = {
                    'piece': '1 piece',
                    'standard': '8 pieces',
                    'family': '16 pieces',
                    'xl': '32 pieces'
                };
                
                packDisplay.textContent = `${packNames[selectedPack]} (${packPieces[selectedPack]})`;
                
                if (isPiecePack) {
                    const totalPieces = quantity;
                    const fullPlates = Math.floor(totalPieces / 8);
                    const remainingPieces = totalPieces % 8;
                    
                    let infoText = `${totalPieces} piece${totalPieces !== 1 ? 's' : ''}`;
                    if (fullPlates > 0) {
                        infoText += ` = ${fullPlates} plate${fullPlates !== 1 ? 's' : ''}`;
                        if (remainingPieces > 0) {
                            infoText += ` + ${remainingPieces} piece${remainingPieces !== 1 ? 's' : ''}`;
                        }
                    }
                    quantityInfo.textContent = infoText;
                } else {
                    const selectedOption = document.querySelector(`.pack-option[data-pack="${selectedPack}"]`);
                    const pieces = selectedOption.dataset.pieces;
                    quantityInfo.textContent = `${quantity} pack${quantity !== 1 ? 's' : ''} √ó ${pieces} pieces = ${quantity * parseInt(pieces)} pieces total`;
                }
            } else {
                // French fries
                const selectedOption = document.querySelector(`.pack-option[data-pack="${selectedPack}"]`);
                const weight = selectedOption.dataset.weight;
                packDisplay.textContent = `${selectedPack.charAt(0).toUpperCase() + selectedPack.slice(1)} Pack (${weight})`;
                quantityInfo.textContent = `${quantity} pack${quantity !== 1 ? 's' : ''} √ó ${weight}`;
            }
            
            document.getElementById('quantity-summary').textContent = `Quantity: ${quantity}`;
        }

        // Update total price
        function updateTotal() {
            let total = 0;
            
            if (selectedPack) {
                const selectedOption = document.querySelector(`.pack-option[data-pack="${selectedPack}"]`);
                const packPrice = parseFloat(selectedOption.dataset.price);
                
                if (isPiecePack) {
                    // Calculate piece price total
                    total = currentItem.piecePrice * quantity;
                } else {
                    total = packPrice * quantity;
                }
            }
            
            document.getElementById('total-price').textContent = `‚Çπ${Math.floor(total)}`;
            updatePackDisplay();
        }

        // Save item to cart
        function saveItemToCart() {
            if (!selectedPack) return;
            
            const selectedOption = document.querySelector(`.pack-option[data-pack="${selectedPack}"]`);
            const packPrice = parseFloat(selectedOption.dataset.price);
            
            let itemName = currentItem.name;
            let itemDescription = '';
            let unitPrice = 0;
            let totalPieces = 0;
            
            if (currentItem.hasPieces) {
                if (isPiecePack) {
                    itemDescription = `${quantity} piece${quantity !== 1 ? 's' : ''}`;
                    unitPrice = currentItem.piecePrice;
                    totalPieces = quantity;
                } else {
                    const pieces = parseInt(selectedOption.dataset.pieces);
                    itemDescription = `${quantity} pack${quantity !== 1 ? 's' : ''} (${pieces} pieces each)`;
                    unitPrice = packPrice;
                    totalPieces = quantity * pieces;
                }
            } else {
                const weight = selectedOption.dataset.weight;
                itemDescription = `${quantity} pack${quantity !== 1 ? 's' : ''} (${weight} each)`;
                unitPrice = packPrice;
            }
            
            const cartItem = {
                id: `${currentItem.id}-${selectedPack}`,
                itemId: currentItem.id,
                name: itemName,
                description: itemDescription,
                image: currentItem.image,
                pack: selectedPack,
                isPiecePack: isPiecePack,
                unitPrice: unitPrice,
                quantity: quantity,
                totalPrice: Math.floor(parseFloat(document.getElementById('total-price').textContent.replace('‚Çπ', ''))),
                totalPieces: totalPieces,
                timestamp: new Date().toISOString()
            };

            const cart = loadCart();
            const existingIndex = cart.findIndex(item => item.id === cartItem.id);
            
            if (existingIndex > -1) {
                cart[existingIndex] = cartItem;
            } else {
                cart.push(cartItem);
            }
            
            saveCart(cart);
            existingCartItem = cartItem;
            isUpdatingExisting = true;
            
            // Update UI
            document.getElementById('delete-item').classList.remove('hidden');
            document.getElementById('update-cart').classList.remove('hidden');
            document.getElementById('add-to-cart').classList.add('hidden');
            
            // Show success message
            const action = existingIndex > -1 ? 'updated' : 'added';
            alert(`‚úÖ Item ${action} to cart!\n${quantity} √ó ${itemName}\nTotal: ‚Çπ${cartItem.totalPrice}`);
            
            updateCartSummary();
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', initPage);
        
        // Check cart expiry on load
        function checkCartExpiry() {
            const expiry = localStorage.getItem('easygo-cart-expiry');
            if (expiry) {
                const expiryDate = new Date(expiry);
                if (new Date() > expiryDate) {
                    localStorage.removeItem('easygo-cart');
                    localStorage.removeItem('easygo-cart-expiry');
                    console.log('Cart expired and cleared');
                }
            }
        }
        
        checkCartExpiry();
    </script>
</body>
</html>
